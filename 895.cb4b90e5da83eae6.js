"use strict";(self.webpackChunkcytube_replay=self.webpackChunkcytube_replay||[]).push([[895],{5895:($,w,m)=>{m.r(w),m.d(w,{IndexModule:()=>z});var b=m(9808),u=m(5861);let X=(()=>{class n{constructor(){this.connected=!1,this.rank=-1,this.premissions={addnontemp:0,chat:0,chatclear:2,deletefromchannellib:2,drink:0,exceedmaxitems:2,exceedmaxlength:0,leaderctl:0,oplaylistadd:-1,oplaylistaddlist:0,oplaylistdelete:0,oplaylistjump:0,oplaylistmove:0,oplaylistnext:0,playlistadd:-1,playlistaddcustom:0,playlistaddlist:0,playlistaddlive:0,playlistclear:0,playlistdelete:0,playlistjump:0,playlistlock:2,playlistmove:0,playlistnext:0,playlistshuffle:0,pollctl:0,pollvote:-1,seeplaylist:-1,settemp:0,viewhiddenpoll:1.5,viewvoteskip:1.5,voteskip:-1},this.playlistLocked=!1,this.emotes=[],this.drinkCount=0,this.channelCSSJS={css:"",cssHash:"1B2M2Y8AsgTpgAmY7PhCfg==",js:"",jsHash:"1B2M2Y8AsgTpgAmY7PhCfg=="},this.motd="",this.chanelOpts={afk_timeout:600,allow_ascii_control:!1,allow_dupes:!1,allow_voteskip:!0,block_anonymous_users:!1,chat_antiflood:!1,chat_antiflood_params:{burst:4,sustained:1,cooldown:4},enable_link_regex:!0,externalcss:"",externaljs:"",maxlength:0,new_user_chat_delay:0,new_user_chat_link_delay:0,pagetitle:"replay",password:!1,playlist_max_duration_per_user:0,playlist_max_per_user:0,show_public:!1,torbanned:!1},this.playlistMeta={count:0,rawTime:0,time:"00:00"},this.playlist=[],this.userlist=[],this.usercount=0,this.chat=[],this.listPlaylists=[],this.polls=[],this.pollsClosed=[],this.skipStates=[]}processEvent(s){let e=s.data[0];try{switch(s.type){case"connect":this.skipStates.forEach(t=>{t.connectedChanged=!0}),this.connected=!0;break;case"rank":this.skipStates.forEach(t=>{t.rankChanged=!0}),this.rank=e;break;case"setPermissions":this.skipStates.forEach(t=>{t.premissionsChanged=!0}),this.premissions=e;break;case"setPlaylistLocked":this.skipStates.forEach(t=>{t.playlistLockedChanged=!0}),this.playlistLocked=e;break;case"emoteList":this.skipStates.forEach(t=>{t.emotesChanged=!0}),this.emotes=e;break;case"drinkCount":this.skipStates.forEach(t=>{t.drinkCountChanged=!0}),this.drinkCount=e;break;case"channelCSSJS":this.skipStates.forEach(t=>{t.channelCSSJSChanged=!0}),this.channelCSSJS=e;break;case"setMotd":this.skipStates.forEach(t=>{t.motdChanged=!0}),this.motd=e;break;case"channelOpts":this.skipStates.forEach(t=>{t.chanelOptsChanged=!0}),this.chanelOpts=e;break;case"setPlaylistMeta":this.skipStates.forEach(t=>{t.playlistMetaChanged=!0}),this.playlistMeta=e;break;case"playlist":this.skipStates.forEach(t=>{t.playlistChanged=!0}),this.playlist=e;break;case"userlist":this.skipStates.forEach(t=>{t.userlistChanged=!0}),this.userlist=e;break;case"usercount":this.skipStates.forEach(t=>{t.usercountChanged=!0}),this.usercount=e;break;case"login":this.skipStates.forEach(t=>{t.loginChanged=!0}),this.login=e;break;case"chatMsg":this.skipStates.forEach(t=>{t.chatMessagesCnt++,-1!=t.chatCleared&&t.chatCleared++}),this.chat.length>20&&this.chat.splice(0,1),this.chat.push(e);break;case"setCurrent":this.skipStates.forEach(t=>{t.currentChanged=!0}),this.current=e;break;case"changeMedia":this.skipStates.forEach(t=>{t.currentMediaChanged=!0,t.currentMediaUpdated=!0}),this.currentMedia=e;break;case"listPlaylists":this.skipStates.forEach(t=>{t.listPlaylistsChanged=!0}),this.listPlaylists=e;break;case"delete":let a=e,h=this.playlist.findIndex(t=>t.uid===a.uid);-1!==h&&(this.skipStates.forEach(t=>{t.playlistChanged=!0}),this.playlist.splice(h,1));break;case"mediaUpdate":let i=e;null!=this.currentMedia&&(this.skipStates.forEach(t=>{t.currentMediaUpdated=!0}),this.currentMedia.paused=i.paused,this.currentMedia.currentTime=i.currentTime);break;case"addUser":this.skipStates.forEach(t=>{t.userlistChanged=!0});let l=e,p=this.userlist.findIndex(t=>t.name.toLowerCase()===l.name.toLowerCase());-1!==p?this.userlist[p]=l:this.userlist.push(l);break;case"setUserMeta":let c=e,v=this.userlist.find(t=>t.name.toLowerCase()===c.name.toLowerCase());null!=v&&(this.skipStates.forEach(t=>{t.userlistChanged=!0}),v.meta=c.meta);break;case"setAFK":let C=e,I=this.userlist.find(t=>t.name.toLowerCase()===C.name.toLowerCase());null!=I&&(this.skipStates.forEach(t=>{t.userlistChanged=!0}),I.meta.afk=C.afk);break;case"setUserRank":let T=e,L=this.userlist.find(t=>t.name.toLowerCase()===T.name.toLowerCase());null!=L&&(this.skipStates.forEach(t=>{t.userlistChanged=!0}),L.rank=T.rank);break;case"userLeave":let K=e,x=this.userlist.findIndex(t=>t.name.toLowerCase()===K.name.toLowerCase());-1!==x&&(this.skipStates.forEach(t=>{t.userlistChanged=!0}),this.userlist.splice(x,1));break;case"clearVoteskipVote":this.skipStates.forEach(t=>{t.voteskipChanged=!0}),this.voteskip=void 0;break;case"newPoll":this.skipStates.forEach(t=>{t.pollsChanged.add(this.polls.length),t.pollsNew.add(this.polls.length)}),this.polls.push(e),this.pollsClosed.push(!1);break;case"updatePoll":this.polls.length>0&&(this.skipStates.forEach(t=>{t.pollsChanged.add(this.polls.length-1),t.pollsUpdated.add(this.polls.length-1)}),this.polls[this.polls.length-1]=e);break;case"queue":let g=e;if("number"==typeof g.after){let t=this.playlist.findIndex(f=>f.uid===g.after);-1!==t&&(t++,this.skipStates.forEach(f=>{f.playlistChanged=!0}),this.playlist.splice(t,0,g.item))}else"append"===g.after?(this.skipStates.forEach(t=>{t.playlistChanged=!0}),this.playlist.push(g.item)):"prepend"===g.after&&(this.skipStates.forEach(t=>{t.playlistChanged=!0}),this.playlist.unshift(g.item));break;case"closePoll":this.pollsClosed.length>0&&(this.skipStates.forEach(t=>{t.pollsChanged.add(this.polls.length-1),t.pollsClosed.add(this.polls.length-1)}),this.pollsClosed[this.pollsClosed.length-1]=!0);break;case"announcement":this.skipStates.forEach(t=>{t.announcementChanged=!0}),this.announcement=e;break;case"disconnect":this.skipStates.forEach(t=>{t.connectedChanged=!0}),this.connected=!1;break;case"moveVideo":let k=e,y=this.playlist.findIndex(t=>t.uid===k.from);if(-1!=y){let t=this.playlist[y];if("number"==typeof k.after){let f=this.playlist.findIndex(P=>P.uid===k.after);-1!=f&&(this.skipStates.forEach(P=>{P.playlistChanged=!0}),y>f&&f++,this.playlist.splice(y,1),this.playlist.splice(f,0,t))}else"append"===k.after?(this.skipStates.forEach(f=>{f.playlistChanged=!0}),this.playlist.splice(y,1),this.playlist.push(t)):"prepend"===k.after&&(this.skipStates.forEach(f=>{f.playlistChanged=!0}),this.playlist.splice(y,1),this.playlist.unshift(t))}break;case"removeEmote":let Q=e,O=this.emotes.findIndex(t=>t.name===Q.name);-1!==O&&(this.skipStates.forEach(t=>{t.emotesChanged=!0}),this.emotes.splice(O,1));break;case"updateEmote":let S=e,U=this.emotes.findIndex(t=>t.name===S.name);this.skipStates.forEach(t=>{t.emotesChanged=!0}),-1!==U?this.emotes[U]=S:this.emotes.push(S);break;case"setLeader":this.skipStates.forEach(t=>{t.leaderChanged=!0}),this.leader=e;break;case"setUserProfile":let R=e,_=this.userlist.find(t=>t.name.toLowerCase()===R.name.toLowerCase());null!=_&&(this.skipStates.forEach(t=>{t.userlistChanged=!0}),_.profile=R.profile);break;case"kick":this.skipStates.forEach(t=>{t.kickedChanged=!0}),this.kicked=e;break;case"partitionChange":console.log("TODO: partitionChange");break;case"voteskip":this.skipStates.forEach(t=>{t.voteskipChanged=!0}),this.voteskip=e;break;case"setTemp":let D=e,J=this.playlist.find(t=>t.uid===D.uid);null!=J&&(this.skipStates.forEach(t=>{t.playlistChanged=!0}),J.temp=D.temp);break;case"cooldown":case"snowpityEvent":case"queue_history":case"playlist_history":case"setRandomPlay":case"voteup":case"pong":break;case"renameEmote":let M=e,N=this.emotes.findIndex(t=>t.name===M.old);-1!==N&&(this.skipStates.forEach(t=>{t.emotesChanged=!0}),delete M.old,this.emotes[N]=M);break;case"clearchat":this.skipStates.forEach(t=>{t.chatCleared=0}),this.chatCleared=e;break;case"channelNotRegistered":this.skipStates.forEach(t=>{t.channelNotRegisteredChanged=!0}),this.channelNotRegistered=!0;break;case"errorMsg":this.skipStates.forEach(t=>{t.errorMsgChanged=!0}),this.errorMsg=e;break;default:let G=JSON.parse(JSON.stringify(s));this.skipStates.forEach(t=>{t.unknownEvents.push(G)}),localStorage.getItem("firlin123Debug")}}catch(a){localStorage.getItem("firlin123Debug")}}prepareFile(s,e){return(0,u.Z)(function*(){let a=JSON.parse(JSON.stringify(s));for(const h of a.events)if("changeMedia"===h.type){let i=h.data[0];if("cm"===i.type){e.text=i.title,console.log("Loading",i.title,i.id);try{let l=n.cachedResponses[i.id];if(null==l&&(l=yield fetch(i.id)),l.ok){let p;"cachedJson"in l?(console.log("Using cached "+i.id),p=l.cachedJson):(p=yield l.json(),n.cachedResponses[i.id]={ok:l.ok,cachedJson:p}),i.meta.direct={};for(const c of p.sources)i.meta.direct[c.quality]=[{contentType:c.contentType,link:c.url,quality:c.quality}]}else"cachedJson"in l||(n.cachedResponses[i.id]={ok:l.ok,cachedJson:null})}catch(l){console.error(l)}}}return a})()}createSkipState(){let s;return this.skipStates.push(s={connectedChanged:!1,rankChanged:!1,premissionsChanged:!1,playlistLockedChanged:!1,emotesChanged:!1,channelNotRegisteredChanged:!1,drinkCountChanged:!1,channelCSSJSChanged:!1,motdChanged:!1,chanelOptsChanged:!1,playlistMetaChanged:!1,playlistChanged:!1,userlistChanged:!1,usercountChanged:!1,loginChanged:!1,chatMessagesCnt:0,currentChanged:!1,currentMediaChanged:!1,currentMediaUpdated:!1,listPlaylistsChanged:!1,voteskipChanged:!1,pollsChanged:new Set,pollsNew:new Set,pollsUpdated:new Set,pollsClosed:new Set,announcementChanged:!1,leaderChanged:!1,errorMsgChanged:!1,kickedChanged:!1,chatCleared:-1,unknownEvents:[]}),s}getSkipStateEvents(s){if(this.skipStates.includes(s)){let e=[];if(s.rankChanged&&e.push(o("rank",this.rank)),s.premissionsChanged&&e.push(o("setPermissions",this.premissions)),s.playlistLockedChanged&&e.push(o("setPlaylistLocked",this.playlistLocked)),s.emotesChanged&&e.push(o("emoteList",this.emotes)),s.channelNotRegisteredChanged&&e.push(o("channelNotRegistered")),s.drinkCountChanged&&e.push(o("drinkCount",this.drinkCount)),s.channelCSSJSChanged&&e.push(o("channelCSSJS",this.channelCSSJS)),s.motdChanged&&e.push(o("setMotd",this.motd)),s.chanelOptsChanged&&e.push(o("channelOpts",this.chanelOpts)),s.playlistMetaChanged&&e.push(o("setPlaylistMeta",this.playlistMeta)),s.playlistChanged&&e.push(o("playlist",this.playlist)),s.userlistChanged&&e.push(o("userlist",this.userlist)),s.usercountChanged&&e.push(o("usercount",this.usercount)),s.loginChanged&&e.push(o("login",this.login)),-1!=s.chatCleared&&e.push(o("chatCleared",this.chatCleared)),s.chatMessagesCnt>0){let a=s.chatMessagesCnt>20?20:s.chatMessagesCnt,h=s.chatMessagesCnt-a,i=this.chat.slice(this.chat.length-a,a);for(const l of i)e.push(o("chatMsg",l));h>0&&e.push(o("chatMsg",{username:"CyTube Replay",msg:"<code>Skipped "+h+" messages</code>",meta:{},time:i[i.length-1].time+1}))}s.currentChanged&&e.push(o("setCurrent",this.current)),s.currentMediaChanged&&e.push(o("changeMedia",this.currentMedia)),s.currentMediaUpdated&&e.push(o("mediaUpdate",this.currentMedia)),s.listPlaylistsChanged&&e.push(o("listPlaylists",this.listPlaylists)),s.voteskipChanged&&e.push(o(null!=this.voteskip?"voteskip":"clearVoteskipVote",this.voteskip));for(let a of s.pollsChanged){let h=this.polls[a];null!=h&&(s.pollsNew.has(a)&&e.push(o("newPoll",h)),s.pollsUpdated.has(a)&&e.push(o("updatePoll",h)),s.pollsClosed.has(a)&&e.push(o("closePoll")))}s.announcementChanged&&e.push(o("announcement",this.announcement)),s.leaderChanged&&e.push(o("setLeader",this.leader)),s.errorMsgChanged&&e.push(o("errorMsg",this.errorMsg));for(let a of s.unknownEvents)"unknownEvent"!==a.type&&e.push(a);return s.kickedChanged&&e.push(o("kick",this.kicked)),s.connectedChanged&&(this.connected?e.unshift(o("connect")):e.push(o("disconnect"))),e}return[]}removeSkipState(s){let e=this.skipStates.indexOf(s);-1!==e&&this.skipStates.splice(e,1)}requestPlaylist(){return[o("setPlaylistMeta",this.playlistMeta),o("playlist",this.playlist),o("setCurrent",null==this.current?0:this.current)]}playerReady(){return null!=this.currentMedia&&null!=this.current?[o("setCurrent",this.current),o("changeMedia",this.currentMedia)]:[]}}return n.cachedResponses={},n})();function o(n,r){return{time:0,type:n,data:null!=r?[r]:[]}}var d=m(5e3);class E{constructor(){this.frame=null,this.window=null,this.resolveFramePromise=null,this.framePromise=new Promise(r=>{this.resolveFramePromise=s=>r(s)}),this.messageReceived=new d.vpe,window.addEventListener("message",r=>{this.messageReceived.emit(r)})}set frameComponent(r){if(this.frame=r,null!=r){if(null!=this.resolveFramePromise){let s=this.resolveFramePromise;this.resolveFramePromise=null,s(r)}}else this.window=null}loadUrl(r,s=!0){var e=this;return(0,u.Z)(function*(){var a;let h=null!==(a=e.frame)&&void 0!==a?a:yield e.framePromise;e.window=yield h.loadUrl(r,s)})()}sendMessage(r,s){null!=this.window&&this.window.postMessage(r,s)}}var Z=m(6844);class A extends E{constructor(r){super(),this.frameFakeConsoleLog=r,this.replayFrameLoaded=!1,this.origin=null,this.resolveReplayFrameOriginPromise=null,this.replayMessageReceived=new d.vpe,this.messageReceived.subscribe(s=>{var e;if("object"==typeof(null===(e=null==s?void 0:s.data)||void 0===e?void 0:e.replayPostMessage)){let a=s.data.replayPostMessage;if("replayWindowLoaded"===a.type&&null!=this.resolveReplayFrameOriginPromise){let h=this.resolveReplayFrameOriginPromise;this.resolveReplayFrameOriginPromise=null,h(a.origin)}else this.replayMessageReceived.emit(a)}})}loadReplayFrame(r){var s=this;return(0,u.Z)(function*(){let e=Z.c.pageVersion(r.site,r.start),a=[r.channelPath,r.channelName,s.frameFakeConsoleLog?1:0,window.location.origin],h=JSON.stringify(a);h="#"+encodeURIComponent(h.substr(1,h.length-2));let i=new Promise(l=>{s.resolveReplayFrameOriginPromise=p=>l(p)});yield s.loadUrl("assets/"+r.site+"-iframe/v"+e+"-page.html?_"+Date.now()+h),s.origin=yield i})()}sendReplayMessage(r){null!=this.origin&&this.sendMessage({replayPostMessage:r},this.origin)}}class F{constructor(){this.cancelDelay=null,this.cancelled=!1,this.remaining=0}cancel(){null!=this.cancelDelay&&this.cancelDelay()}start(r){var s=this;return(0,u.Z)(function*(){s.cancelDelay=null,s.cancelled=!1,s.remaining=0;let e=Date.now();return yield new Promise(a=>{let h=window.setTimeout(()=>a(),r);s.cancelDelay=()=>{window.clearTimeout(h);let i=r-(Date.now()-e);s.remaining=i<0?0:i,s.cancelled=!0,s.cancelDelay=null,a()}}),s.cancelled})()}}var V=m(9757);let j=(()=>{class n{constructor(s){this.location=s,this.frame=null,this.myFrameControl=null,this.resolveLoadingUrlPromise=null,this.loadingUrlPromise=null,this.resolveLoadingFramePromise=null,this.loadingFramePromise=new Promise(e=>{this.resolveLoadingFramePromise=a=>e(a)})}ngOnDestroy(){null!=this.myFrameControl&&(this.myFrameControl.frameComponent=null)}ngOnChanges(s){if("myFrameControl"in s){let e=s.myFrameControl;e.previousValue instanceof E&&(e.previousValue.frameComponent=null),e.currentValue.frameComponent=this}}ngOnInit(){}onLoadFrame(s){null!=s&&(null==this.frame?(this.frame=s,null!=this.resolveLoadingFramePromise&&this.resolveLoadingFramePromise(s)):null!=s.contentWindow&&this.onLoadWindow(s.contentWindow))}onLoadWindow(s){if(null!=this.resolveLoadingUrlPromise){let e=this.resolveLoadingUrlPromise;this.resolveLoadingUrlPromise=null,e(s)}}loadUrl(s,e=!0){var a=this;return(0,u.Z)(function*(){let h=e?a.location.prepareExternalUrl(s):s,i=a.loadingUrlPromise;return a.loadingUrlPromise=new Promise(function(){var l=(0,u.Z)(function*(p){var c;null!=i&&(yield i);let v=null!==(c=a.frame)&&void 0!==c?c:yield a.loadingFramePromise;a.resolveLoadingUrlPromise=C=>p(C),v.src=h});return function(p){return l.apply(this,arguments)}}()),yield a.loadingUrlPromise})()}}return n.\u0275fac=function(s){return new(s||n)(d.Y36(b.Ye))},n.\u0275cmp=d.Xpm({type:n,selectors:[["app-my-frame"]],inputs:{myFrameControl:"myFrameControl"},features:[d.TTD],decls:2,vars:0,consts:[[3,"load"],["myFrame",""]],template:function(s,e){if(1&s){const a=d.EpF();d.TgZ(0,"iframe",0,1),d.NdJ("load",function(){d.CHM(a);const i=d.MAs(1);return e.onLoadFrame(i)}),d.qZA()}},styles:["iframe[_ngcontent-%COMP%]{border:0;width:100%;height:100%}"]}),n})(),H=(()=>{class n{constructor(s){this.navItems=s,this.skipOffset=0,this.fileLoadPromise=null,this.delay=new F,this.playing=!1,this.currentI=0,this.timeOffset=0,this.speedX=1,this.navItems.hideAll(),this.frameControl=new A(!1),this.navItems.onlyFileSelectConfig(),this.replayMessageSubscription=this.frameControl.replayMessageReceived.subscribe(e=>{this.replayMessage(e)}),this.selectedFileSubscription=this.navItems.fileList.selectedChanges.subscribe(e=>{this.changeFile(e)}),this.speedXSubscription=this.navItems.speedX.valueChanges.subscribe(e=>{this.changeSpeedX(e)}),null!=this.navItems.fileList.selected&&this.changeFile(this.navItems.fileList.selected)}ngOnInit(){}ngOnDestroy(){this.playing&&this.pause(),this.unsubFromEvents(),this.navItems.skipTo.file=void 0}unsubFromEvents(){var s,e,a;this.replayMessageSubscription.unsubscribe(),this.selectedFileSubscription.unsubscribe(),this.speedXSubscription.unsubscribe(),null===(s=this.playPauseSubscription)||void 0===s||s.unsubscribe(),null===(e=this.skipToTimeSubscription)||void 0===e||e.unsubscribe(),null===(a=this.skipToCustomTimeSubscription)||void 0===a||a.unsubscribe()}replayMessage(s){"replayEmit"===s.type?this.replayEmit(s):console.log("replay msg:",s)}replayEmit(s){switch(s.key){case"requestPlaylist":case"playerReady":if(null!=this.replayState){let e=this.replayState[s.key]();this.frameControl.sendReplayMessage({type:"replayEventPack",events:e})}break;default:console.log("replay emit:",s)}}changeSpeedX(s){var e=this;return(0,u.Z)(function*(){e.playing&&(yield e.pause(!1),e.play(!1)),e.frameControl.sendReplayMessage({type:"replaySpeedXChange",speedX:s})})()}changeFile(s){var e=this;return(0,u.Z)(function*(){let a=e.fileLoadPromise;e.fileLoadPromise=new Promise(function(){var h=(0,u.Z)(function*(i){null!=a&&(yield a);try{e.navItems.loadingConfig(""!==s.name?s.name:s.channelName),e.playing&&(yield e.pause()),e.skipOffset=0,e.currentI=0,e.timeOffset=0,e.delay=new F,e.speedX=1,e.replayState=new X,s=yield e.replayState.prepareFile(s,e.navItems.loading),e.navItems.loading.text=""!==s.name?s.name:s.channelName,yield e.frameControl.loadReplayFrame(s),null==e.playPauseSubscription&&(e.playPauseSubscription=e.navItems.playPause.clicked.subscribe(l=>{e.playing?e.pause():e.play()})),e.navItems.skipTo.currentI=e.currentI,e.navItems.skipTo.file=s,null==e.skipToTimeSubscription&&(e.skipToTimeSubscription=e.navItems.skipTo.skipToTimeChanges.subscribe(l=>{e.skipToTime(l)})),null==e.skipToCustomTimeSubscription&&(e.skipToCustomTimeSubscription=e.navItems.skipTo.skipCustomTimeChanges.subscribe(l=>{e.skipCustomTime(l)})),e.navItems.readyToPlayConfig(),e.file=s}catch(l){console.log("Change file error:",l)}i()});return function(i){return h.apply(this,arguments)}}()),yield e.fileLoadPromise})()}skipToTime(s){var e=this;return(0,u.Z)(function*(){null!=e.file&&(console.log("skip to",s),yield e.setSkipOffset(s-e.file.events[e.currentI].time))})()}skipCustomTime(s){var e=this;return(0,u.Z)(function*(){null!=e.file&&(console.log("skip for",s),yield e.setSkipOffset(s))})()}setSkipOffset(s){var e=this;return(0,u.Z)(function*(){let a=e.playing;e.playing&&(yield e.pause(!1)),e.skipOffset=s,a&&e.play(!1)})()}pause(s=!0){var e=this;return(0,u.Z)(function*(){null!=e.file&&e.playing&&(e.playing=!1,s&&(e.navItems.playPause.paused=!0,e.frameControl.sendReplayMessage({type:"replayPausedChange",paused:!0})),e.delay.cancel(),yield e.playThreadPromise)})()}play(s=!0){let e=0;this.skipOffset>0&&(e=this.skipOffset,this.skipOffset=0),null!=this.file&&!this.playing&&(this.timeOffset=Date.now()+this.delay.remaining-this.file.events[this.currentI].time-e,this.playing=!0,s&&(this.navItems.playPause.paused=!1,this.frameControl.sendReplayMessage({type:"replayPausedChange",paused:!1})),(this.playThreadPromise=this.playThread(0!==e)).then(()=>{this.playThreadPromise=void 0}))}playThread(s=!1){var e=this;return(0,u.Z)(function*(){if(null!=e.file&&null!=e.replayState){console.log("playThread started");let a=s?e.replayState.createSkipState():null;for(let i=e.currentI;i<e.file.events.length;i++){e.currentI=i;let l=e.file.events[i],c=l.time+e.timeOffset-Date.now();if(c>0&&s&&null!=a&&(s=!1,e.skippingDone(e.replayState,a,i-1)),1!=e.speedX&&(e.timeOffset-=c-Math.floor(c/e.speedX),c=Math.floor(c/e.speedX)),s)e.replayState.processEvent(l),e.eventHook(l);else{if(yield e.delay.start(c),e.delay.cancelled)break;e.navItems.skipTo.currentI=i,e.replayState.processEvent(l),"function"==typeof globalThis.replayEventHook&&globalThis.replayEventHook(e,l),e.frameControl.sendReplayMessage({type:"replayEvent",key:l.type,data:l.data})}}let h=!1;s&&null!=a?(s=!1,e.skippingDone(e.replayState,a,e.file.events.length-1),h=!0):e.delay.cancelled||(h=!0),h&&(console.log("File ended"),e.pause()),console.log("playThread stopped")}})()}skippingDone(s,e,a){console.log("Skipping done"),this.navItems.skipTo.currentI=a;let h=s.getSkipStateEvents(e);s.removeSkipState(e),this.frameControl.sendReplayMessage({type:"replayEventPack",events:h})}eventHook(s){"function"==typeof globalThis.replayEventHook&&globalThis.replayEventHook(this,s)}get speedX(){return this.navItems.speedX.value}set speedX(s){this.navItems.speedX.value=s}}return n.\u0275fac=function(s){return new(s||n)(d.Y36(V.Y))},n.\u0275cmp=d.Xpm({type:n,selectors:[["app-index"]],decls:1,vars:1,consts:[[3,"myFrameControl"]],template:function(s,e){1&s&&d._UZ(0,"app-my-frame",0),2&s&&d.Q6J("myFrameControl",e.frameControl)},directives:[j],styles:["[_nghost-%COMP%]{flex:1;display:flex}app-my-frame[_ngcontent-%COMP%]{flex:1}"]}),n})();var Y=m(5834);let W=(()=>{class n{}return n.\u0275fac=function(s){return new(s||n)},n.\u0275mod=d.oAB({type:n}),n.\u0275inj=d.cJS({imports:[[b.ez]]}),n})();const B=[{path:"",component:H}];let z=(()=>{class n{}return n.\u0275fac=function(s){return new(s||n)},n.\u0275mod=d.oAB({type:n}),n.\u0275inj=d.cJS({imports:[[b.ez,Y.Bz.forChild(B),W]]}),n})()}}]);