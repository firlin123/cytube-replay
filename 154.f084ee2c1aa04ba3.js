"use strict";(self.webpackChunkcytube_replay=self.webpackChunkcytube_replay||[]).push([[154],{1154:(se,w,m)=>{m.r(w),m.d(w,{IndexModule:()=>q});var k=m(9808),u=m(5861);let Z=(()=>{class i{constructor(){this.connected=!1,this.rank=-1,this.premissions={addnontemp:0,chat:0,chatclear:2,deletefromchannellib:2,drink:0,exceedmaxitems:2,exceedmaxlength:0,leaderctl:0,oplaylistadd:-1,oplaylistaddlist:0,oplaylistdelete:0,oplaylistjump:0,oplaylistmove:0,oplaylistnext:0,playlistadd:-1,playlistaddcustom:0,playlistaddlist:0,playlistaddlive:0,playlistclear:0,playlistdelete:0,playlistjump:0,playlistlock:2,playlistmove:0,playlistnext:0,playlistshuffle:0,pollctl:0,pollvote:-1,seeplaylist:-1,settemp:0,viewhiddenpoll:1.5,viewvoteskip:1.5,voteskip:-1},this.playlistLocked=!1,this.emotes=[],this.drinkCount=0,this.channelCSSJS={css:"",cssHash:"1B2M2Y8AsgTpgAmY7PhCfg==",js:"",jsHash:"1B2M2Y8AsgTpgAmY7PhCfg=="},this.motd="",this.chanelOpts={afk_timeout:600,allow_ascii_control:!1,allow_dupes:!1,allow_voteskip:!0,block_anonymous_users:!1,chat_antiflood:!1,chat_antiflood_params:{burst:4,sustained:1,cooldown:4},enable_link_regex:!0,externalcss:"",externaljs:"",maxlength:0,new_user_chat_delay:0,new_user_chat_link_delay:0,pagetitle:"replay",password:!1,playlist_max_duration_per_user:0,playlist_max_per_user:0,show_public:!1,torbanned:!1},this.playlistMeta={count:0,rawTime:0,time:"00:00"},this.playlist=[],this.userlist=[],this.usercount=0,this.chat=[],this.listPlaylists=[],this.polls=[],this.pollsClosed=[],this.skipStates=[]}processEvent(s){let e=s.data[0];try{switch(s.type){case"connect":this.skipStates.forEach(t=>{t.connectedChanged=!0}),this.connected=!0;break;case"rank":this.skipStates.forEach(t=>{t.rankChanged=!0}),this.rank=e;break;case"setPermissions":this.skipStates.forEach(t=>{t.premissionsChanged=!0}),this.premissions=e;break;case"setPlaylistLocked":this.skipStates.forEach(t=>{t.playlistLockedChanged=!0}),this.playlistLocked=e;break;case"emoteList":this.skipStates.forEach(t=>{t.emotesChanged=!0}),this.emotes=e;break;case"drinkCount":this.skipStates.forEach(t=>{t.drinkCountChanged=!0}),this.drinkCount=e;break;case"channelCSSJS":this.skipStates.forEach(t=>{t.channelCSSJSChanged=!0}),this.channelCSSJS=e;break;case"setMotd":this.skipStates.forEach(t=>{t.motdChanged=!0}),this.motd=e;break;case"channelOpts":this.skipStates.forEach(t=>{t.chanelOptsChanged=!0}),this.chanelOpts=e;break;case"setPlaylistMeta":this.skipStates.forEach(t=>{t.playlistMetaChanged=!0}),this.playlistMeta=e;break;case"playlist":this.skipStates.forEach(t=>{t.playlistChanged=!0}),this.playlist=e;break;case"userlist":this.skipStates.forEach(t=>{t.userlistChanged=!0}),this.userlist=e;break;case"usercount":this.skipStates.forEach(t=>{t.usercountChanged=!0}),this.usercount=e;break;case"login":this.skipStates.forEach(t=>{t.loginChanged=!0}),this.login=e;break;case"chatMsg":this.skipStates.forEach(t=>{t.chatMessagesCnt++,-1!=t.chatCleared&&t.chatCleared++}),this.chat.length>20&&this.chat.splice(0,1),this.chat.push(e);break;case"setCurrent":this.skipStates.forEach(t=>{t.currentChanged=!0}),this.current=e;break;case"changeMedia":this.skipStates.forEach(t=>{t.currentMediaChanged=!0,t.currentMediaUpdated=!0}),this.currentMedia=e;break;case"listPlaylists":this.skipStates.forEach(t=>{t.listPlaylistsChanged=!0}),this.listPlaylists=e;break;case"delete":let a=e,h=this.playlist.findIndex(t=>t.uid===a.uid);-1!==h&&(this.skipStates.forEach(t=>{t.playlistChanged=!0}),this.playlist.splice(h,1));break;case"mediaUpdate":let r=e;null!=this.currentMedia&&(this.skipStates.forEach(t=>{t.currentMediaUpdated=!0}),this.currentMedia.paused=r.paused,this.currentMedia.currentTime=r.currentTime);break;case"addUser":this.skipStates.forEach(t=>{t.userlistChanged=!0});let o=e,p=this.userlist.findIndex(t=>t.name.toLowerCase()===o.name.toLowerCase());-1!==p?this.userlist[p]=o:this.userlist.push(o);break;case"setUserMeta":let c=e,b=this.userlist.find(t=>t.name.toLowerCase()===c.name.toLowerCase());null!=b&&(this.skipStates.forEach(t=>{t.userlistChanged=!0}),b.meta=c.meta);break;case"setAFK":let C=e,T=this.userlist.find(t=>t.name.toLowerCase()===C.name.toLowerCase());null!=T&&(this.skipStates.forEach(t=>{t.userlistChanged=!0}),T.meta.afk=C.afk);break;case"setUserRank":let F=e,x=this.userlist.find(t=>t.name.toLowerCase()===F.name.toLowerCase());null!=x&&(this.skipStates.forEach(t=>{t.userlistChanged=!0}),x.rank=F.rank);break;case"userLeave":let K=e,L=this.userlist.findIndex(t=>t.name.toLowerCase()===K.name.toLowerCase());-1!==L&&(this.skipStates.forEach(t=>{t.userlistChanged=!0}),this.userlist.splice(L,1));break;case"clearVoteskipVote":this.skipStates.forEach(t=>{t.voteskipChanged=!0}),this.voteskip=void 0;break;case"newPoll":this.skipStates.forEach(t=>{t.pollsChanged.add(this.polls.length),t.pollsNew.add(this.polls.length)}),this.polls.push(e),this.pollsClosed.push(!1);break;case"updatePoll":this.polls.length>0&&(this.skipStates.forEach(t=>{t.pollsChanged.add(this.polls.length-1),t.pollsUpdated.add(this.polls.length-1)}),this.polls[this.polls.length-1]=e);break;case"queue":let g=e;if("number"==typeof g.after){let t=this.playlist.findIndex(f=>f.uid===g.after);-1!==t&&(t++,this.skipStates.forEach(f=>{f.playlistChanged=!0}),this.playlist.splice(t,0,g.item))}else"append"===g.after?(this.skipStates.forEach(t=>{t.playlistChanged=!0}),this.playlist.push(g.item)):"prepend"===g.after&&(this.skipStates.forEach(t=>{t.playlistChanged=!0}),this.playlist.unshift(g.item));break;case"closePoll":this.pollsClosed.length>0&&(this.skipStates.forEach(t=>{t.pollsChanged.add(this.polls.length-1),t.pollsClosed.add(this.polls.length-1)}),this.pollsClosed[this.pollsClosed.length-1]=!0);break;case"announcement":this.skipStates.forEach(t=>{t.announcementChanged=!0}),this.announcement=e;break;case"disconnect":this.skipStates.forEach(t=>{t.connectedChanged=!0}),this.connected=!1;break;case"moveVideo":let v=e,y=this.playlist.findIndex(t=>t.uid===v.from);if(-1!=y){let t=this.playlist[y];if("number"==typeof v.after){let f=this.playlist.findIndex(P=>P.uid===v.after);-1!=f&&(this.skipStates.forEach(P=>{P.playlistChanged=!0}),y>f&&f++,this.playlist.splice(y,1),this.playlist.splice(f,0,t))}else"append"===v.after?(this.skipStates.forEach(f=>{f.playlistChanged=!0}),this.playlist.splice(y,1),this.playlist.push(t)):"prepend"===v.after&&(this.skipStates.forEach(f=>{f.playlistChanged=!0}),this.playlist.splice(y,1),this.playlist.unshift(t))}break;case"removeEmote":let G=e,O=this.emotes.findIndex(t=>t.name===G.name);-1!==O&&(this.skipStates.forEach(t=>{t.emotesChanged=!0}),this.emotes.splice(O,1));break;case"updateEmote":let S=e,U=this.emotes.findIndex(t=>t.name===S.name);this.skipStates.forEach(t=>{t.emotesChanged=!0}),-1!==U?this.emotes[U]=S:this.emotes.push(S);break;case"setLeader":this.skipStates.forEach(t=>{t.leaderChanged=!0}),this.leader=e;break;case"setUserProfile":let _=e,R=this.userlist.find(t=>t.name.toLowerCase()===_.name.toLowerCase());null!=R&&(this.skipStates.forEach(t=>{t.userlistChanged=!0}),R.profile=_.profile);break;case"kick":this.skipStates.forEach(t=>{t.kickedChanged=!0}),this.kicked=e;break;case"partitionChange":console.log("TODO: partitionChange");break;case"voteskip":this.skipStates.forEach(t=>{t.voteskipChanged=!0}),this.voteskip=e;break;case"setTemp":let J=e,D=this.playlist.find(t=>t.uid===J.uid);null!=D&&(this.skipStates.forEach(t=>{t.playlistChanged=!0}),D.temp=J.temp);break;case"cooldown":case"snowpityEvent":case"queue_history":case"playlist_history":case"setRandomPlay":case"voteup":case"pong":break;case"renameEmote":let M=e,N=this.emotes.findIndex(t=>t.name===M.old);-1!==N&&(this.skipStates.forEach(t=>{t.emotesChanged=!0}),delete M.old,this.emotes[N]=M);break;case"clearchat":this.skipStates.forEach(t=>{t.chatCleared=0}),this.chatCleared=e;break;case"channelNotRegistered":this.skipStates.forEach(t=>{t.channelNotRegisteredChanged=!0}),this.channelNotRegistered=!0;break;case"errorMsg":this.skipStates.forEach(t=>{t.errorMsgChanged=!0}),this.errorMsg=e;break;default:let ee=JSON.parse(JSON.stringify(s));this.skipStates.forEach(t=>{t.unknownEvents.push(ee)}),localStorage.getItem("firlin123Debug")}}catch(a){localStorage.getItem("firlin123Debug")}}prepareFile(s,e){return(0,u.Z)(function*(){let a=JSON.parse(JSON.stringify(s));for(const h of a.events)if("changeMedia"===h.type){let r=h.data[0];if("cm"===r.type){e.text=r.title,console.log("Loading",r.title,r.id);try{let o=i.cachedResponses[r.id];if(null==o&&(o=yield fetch(r.id)),o.ok){let p;"cachedJson"in o?(console.log("Using cached "+r.id),p=o.cachedJson):(p=yield o.json(),i.cachedResponses[r.id]={ok:o.ok,cachedJson:p}),r.meta.direct={};for(const c of p.sources)r.meta.direct[c.quality]=[{contentType:c.contentType,link:c.url,quality:c.quality}]}else"cachedJson"in o||(i.cachedResponses[r.id]={ok:o.ok,cachedJson:null})}catch(o){console.error(o)}}}return a.events.unshift(n("snowpityEvent",null,a.start,a.nextUid++)),a.events.push(n("snowpityEvent",null,a.end,a.nextUid++)),a})()}createSkipState(){let s;return this.skipStates.push(s={connectedChanged:!1,rankChanged:!1,premissionsChanged:!1,playlistLockedChanged:!1,emotesChanged:!1,channelNotRegisteredChanged:!1,drinkCountChanged:!1,channelCSSJSChanged:!1,motdChanged:!1,chanelOptsChanged:!1,playlistMetaChanged:!1,playlistChanged:!1,userlistChanged:!1,usercountChanged:!1,loginChanged:!1,chatMessagesCnt:0,currentChanged:!1,currentMediaChanged:!1,currentMediaUpdated:!1,listPlaylistsChanged:!1,voteskipChanged:!1,pollsChanged:new Set,pollsNew:new Set,pollsUpdated:new Set,pollsClosed:new Set,announcementChanged:!1,leaderChanged:!1,errorMsgChanged:!1,kickedChanged:!1,chatCleared:-1,unknownEvents:[]}),s}getSkipStateEvents(s){if(this.skipStates.includes(s)){let e=[];if(s.rankChanged&&e.push(n("rank",this.rank)),s.premissionsChanged&&e.push(n("setPermissions",this.premissions)),s.playlistLockedChanged&&e.push(n("setPlaylistLocked",this.playlistLocked)),s.emotesChanged&&e.push(n("emoteList",this.emotes)),s.channelNotRegisteredChanged&&e.push(n("channelNotRegistered")),s.drinkCountChanged&&e.push(n("drinkCount",this.drinkCount)),s.channelCSSJSChanged&&e.push(n("channelCSSJS",this.channelCSSJS)),s.motdChanged&&e.push(n("setMotd",this.motd)),s.chanelOptsChanged&&e.push(n("channelOpts",this.chanelOpts)),s.playlistMetaChanged&&e.push(n("setPlaylistMeta",this.playlistMeta)),s.playlistChanged&&e.push(n("playlist",this.playlist)),s.userlistChanged&&e.push(n("userlist",this.userlist)),s.usercountChanged&&e.push(n("usercount",this.usercount)),s.loginChanged&&e.push(n("login",this.login)),-1!=s.chatCleared&&e.push(n("chatCleared",this.chatCleared)),s.chatMessagesCnt>0){let a=s.chatMessagesCnt>20?20:s.chatMessagesCnt,h=s.chatMessagesCnt-a,r=this.chat.slice(this.chat.length-a,a);for(const o of r)e.push(n("chatMsg",o));h>0&&e.push(n("chatMsg",{username:"CyTube Replay",msg:"<code>Skipped "+h+" messages</code>",meta:{},time:r[r.length-1].time+1}))}s.currentChanged&&e.push(n("setCurrent",this.current)),s.currentMediaChanged&&e.push(n("changeMedia",this.currentMedia)),s.currentMediaUpdated&&e.push(n("mediaUpdate",this.currentMedia)),s.listPlaylistsChanged&&e.push(n("listPlaylists",this.listPlaylists)),s.voteskipChanged&&e.push(n(null!=this.voteskip?"voteskip":"clearVoteskipVote",this.voteskip));for(let a of s.pollsChanged){let h=this.polls[a];null!=h&&(s.pollsNew.has(a)&&e.push(n("newPoll",h)),s.pollsUpdated.has(a)&&e.push(n("updatePoll",h)),s.pollsClosed.has(a)&&e.push(n("closePoll")))}s.announcementChanged&&e.push(n("announcement",this.announcement)),s.leaderChanged&&e.push(n("setLeader",this.leader)),s.errorMsgChanged&&e.push(n("errorMsg",this.errorMsg));for(let a of s.unknownEvents)"unknownEvent"!==a.type&&e.push(a);return s.kickedChanged&&e.push(n("kick",this.kicked)),s.connectedChanged&&(this.connected?e.unshift(n("connect")):e.push(n("disconnect"))),e}return[]}removeSkipState(s){let e=this.skipStates.indexOf(s);-1!==e&&this.skipStates.splice(e,1)}requestPlaylist(){return[n("setPlaylistMeta",this.playlistMeta),n("playlist",this.playlist),n("setCurrent",null==this.current?0:this.current)]}playerReady(){return null!=this.currentMedia&&null!=this.current?[n("setCurrent",this.current),n("changeMedia",this.currentMedia)]:[]}}return i.cachedResponses={},i})();function n(i,l,s=0,e=0){return{time:s,type:i,data:null!=l?[l]:[],uid:e}}var d=m(5e3);class E{constructor(){this.frame=null,this.window=null,this.resolveFramePromise=null,this.framePromise=new Promise(l=>{this.resolveFramePromise=s=>l(s)}),this.messageReceived=new d.vpe,window.addEventListener("message",l=>{this.messageReceived.emit(l)})}set frameComponent(l){if(this.frame=l,null!=l){if(null!=this.resolveFramePromise){let s=this.resolveFramePromise;this.resolveFramePromise=null,s(l)}}else this.window=null}loadUrl(l,s=!0){var e=this;return(0,u.Z)(function*(){var a;let h=null!==(a=e.frame)&&void 0!==a?a:yield e.framePromise;e.window=yield h.loadUrl(l,s)})()}sendMessage(l,s){null!=this.window&&this.window.postMessage(l,s)}}var X=m(6844);class A extends E{constructor(l){super(),this.frameFakeConsoleLog=l,this.replayFrameLoaded=!1,this.origin=null,this.resolveReplayFrameOriginPromise=null,this.replayMessageReceived=new d.vpe,this.messageReceived.subscribe(s=>{var e;if("object"==typeof(null===(e=null==s?void 0:s.data)||void 0===e?void 0:e.replayPostMessage)){let a=s.data.replayPostMessage;if("replayWindowLoaded"===a.type&&null!=this.resolveReplayFrameOriginPromise){let h=this.resolveReplayFrameOriginPromise;this.resolveReplayFrameOriginPromise=null,h(a.origin)}else this.replayMessageReceived.emit(a)}})}loadReplayFrame(l){var s=this;return(0,u.Z)(function*(){let e=X.c.pageVersion(l.site,l.start),a=[l.channelPath,l.channelName,s.frameFakeConsoleLog?1:0,window.location.origin],h=JSON.stringify(a);h="#"+encodeURIComponent(h.substr(1,h.length-2));let r=new Promise(o=>{s.resolveReplayFrameOriginPromise=p=>o(p)});yield s.loadUrl("assets/"+l.site+"-iframe/v"+e+"-page.html?_"+Date.now()+h),s.origin=yield r})()}sendReplayMessage(l){null!=this.origin&&this.sendMessage({replayPostMessage:l},this.origin)}}class I{constructor(){this.cancelDelay=null,this.cancelled=!1,this.remaining=0}cancel(){null!=this.cancelDelay&&this.cancelDelay()}start(l){var s=this;return(0,u.Z)(function*(){s.cancelDelay=null,s.cancelled=!1,s.remaining=0;let e=Date.now();return yield new Promise(a=>{let h=window.setTimeout(()=>a(),l);s.cancelDelay=()=>{window.clearTimeout(h);let r=l-(Date.now()-e);s.remaining=r<0?0:r,s.cancelled=!0,s.cancelDelay=null,a()}}),s.cancelled})()}}var j=m(9757);let V=(()=>{class i{constructor(s){this.location=s,this.frame=null,this.myFrameControl=null,this.resolveLoadingUrlPromise=null,this.loadingUrlPromise=null,this.resolveLoadingFramePromise=null,this.loadingFramePromise=new Promise(e=>{this.resolveLoadingFramePromise=a=>e(a)})}ngOnDestroy(){null!=this.myFrameControl&&(this.myFrameControl.frameComponent=null)}ngOnChanges(s){if("myFrameControl"in s){let e=s.myFrameControl;e.previousValue instanceof E&&(e.previousValue.frameComponent=null),e.currentValue.frameComponent=this}}ngOnInit(){}onLoadFrame(s){null!=s&&(null==this.frame?(this.frame=s,null!=this.resolveLoadingFramePromise&&this.resolveLoadingFramePromise(s)):null!=s.contentWindow&&this.onLoadWindow(s.contentWindow))}onLoadWindow(s){if(null!=this.resolveLoadingUrlPromise){let e=this.resolveLoadingUrlPromise;this.resolveLoadingUrlPromise=null,e(s)}}loadUrl(s,e=!0){var a=this;return(0,u.Z)(function*(){let h=e?a.location.prepareExternalUrl(s):s,r=a.loadingUrlPromise;return a.loadingUrlPromise=new Promise(function(){var o=(0,u.Z)(function*(p){var c;null!=r&&(yield r);let b=null!==(c=a.frame)&&void 0!==c?c:yield a.loadingFramePromise;a.resolveLoadingUrlPromise=C=>p(C),b.src=h});return function(p){return o.apply(this,arguments)}}()),yield a.loadingUrlPromise})()}}return i.\u0275fac=function(s){return new(s||i)(d.Y36(k.Ye))},i.\u0275cmp=d.Xpm({type:i,selectors:[["app-my-frame"]],inputs:{myFrameControl:"myFrameControl"},features:[d.TTD],decls:2,vars:0,consts:[[3,"load"],["myFrame",""]],template:function(s,e){if(1&s){const a=d.EpF();d.TgZ(0,"iframe",0,1),d.NdJ("load",function(){d.CHM(a);const r=d.MAs(1);return e.onLoadFrame(r)}),d.qZA()}},styles:["iframe[_ngcontent-%COMP%]{border:0;width:100%;height:100%}"]}),i})();function Y(i,l){1&i&&(d.TgZ(0,"div",2),d._uU(1,"No files selected."),d.qZA())}function H(i,l){if(1&i&&(d.TgZ(0,"div",2),d._uU(1),d.qZA()),2&i){const s=d.oxw();d.xp6(1),d.hij("",s.navItems.loading.getText()," ...")}}let W=(()=>{class i{constructor(s){this.navItems=s,this.loading=!1,this.skipOffset=0,this.fileLoadPromise=null,this.delay=new I,this.playing=!1,this.currentI=0,this.timeOffset=0,this.speedX=1,this.navItems.hideAll(),this.frameControl=new A(!1),this.navItems.onlyFileSelectConfig(),this.replayMessageSubscription=this.frameControl.replayMessageReceived.subscribe(e=>{this.replayMessage(e)}),this.selectedFileSubscription=this.navItems.fileList.selectedChanges.subscribe(e=>{this.changeFile(e)}),this.speedXSubscription=this.navItems.speedX.valueChanges.subscribe(e=>{this.changeSpeedX(e)}),null!=this.navItems.fileList.selected&&this.changeFile(this.navItems.fileList.selected)}ngOnInit(){}ngOnDestroy(){this.playing&&this.pause(),this.unsubFromEvents(),this.navItems.skipTo.file=void 0}unsubFromEvents(){var s,e,a;this.replayMessageSubscription.unsubscribe(),this.selectedFileSubscription.unsubscribe(),this.speedXSubscription.unsubscribe(),null===(s=this.playPauseSubscription)||void 0===s||s.unsubscribe(),null===(e=this.skipToTimeSubscription)||void 0===e||e.unsubscribe(),null===(a=this.skipToCustomTimeSubscription)||void 0===a||a.unsubscribe()}replayMessage(s){"replayEmit"===s.type?this.replayEmit(s):console.log("replay msg:",s)}replayEmit(s){switch(s.key){case"requestPlaylist":case"playerReady":if(null!=this.replayState){let e=this.replayState[s.key]();this.frameControl.sendReplayMessage({type:"replayEventPack",events:e})}break;default:console.log("replay emit:",s)}}changeSpeedX(s){var e=this;return(0,u.Z)(function*(){e.playing&&(yield e.pause(!1),e.play(!1)),e.frameControl.sendReplayMessage({type:"replaySpeedXChange",speedX:s})})()}changeFile(s){var e=this;return(0,u.Z)(function*(){let a=e.fileLoadPromise;e.fileLoadPromise=new Promise(function(){var h=(0,u.Z)(function*(r){null!=a&&(yield a);try{e.navItems.loadingConfig(""!==s.name?s.name:s.channelName),e.playing&&(yield e.pause()),e.skipOffset=0,e.currentI=0,e.timeOffset=0,e.delay=new I,e.speedX=1,e.replayState=new Z,s=yield e.replayState.prepareFile(s,e.navItems.loading),e.navItems.loading.text=""!==s.name?s.name:s.channelName,yield e.frameControl.loadReplayFrame(s),null==e.playPauseSubscription&&(e.playPauseSubscription=e.navItems.playPause.clicked.subscribe(o=>{e.playing?e.pause():e.play()})),e.navItems.skipTo.currentI=e.currentI,e.navItems.skipTo.file=s,null==e.skipToTimeSubscription&&(e.skipToTimeSubscription=e.navItems.skipTo.skipToTimeChanges.subscribe(o=>{e.skipToTime(o)})),null==e.skipToCustomTimeSubscription&&(e.skipToCustomTimeSubscription=e.navItems.skipTo.skipCustomTimeChanges.subscribe(o=>{e.skipCustomTime(o)})),e.navItems.readyToPlayConfig(),e.file=s}catch(o){console.log("Change file error:",o)}r()});return function(r){return h.apply(this,arguments)}}()),e.loading=!0,yield e.fileLoadPromise,e.loading=!1})()}skipToTime(s){var e=this;return(0,u.Z)(function*(){null!=e.file&&(console.log("skip to",s),yield e.setSkipOffset(s-e.file.events[e.currentI].time))})()}skipCustomTime(s){var e=this;return(0,u.Z)(function*(){null!=e.file&&(console.log("skip for",s),yield e.setSkipOffset(s))})()}setSkipOffset(s){var e=this;return(0,u.Z)(function*(){let a=e.playing;e.playing&&(yield e.pause(!1)),e.skipOffset=s,a&&e.play(!1)})()}pause(s=!0){var e=this;return(0,u.Z)(function*(){null!=e.file&&e.playing&&(e.playing=!1,s&&(e.navItems.playPause.paused=!0,e.frameControl.sendReplayMessage({type:"replayPausedChange",paused:!0})),e.delay.cancel(),yield e.playThreadPromise)})()}play(s=!0){let e=0;this.skipOffset>0&&(e=this.skipOffset,this.skipOffset=0),null!=this.file&&!this.playing&&(this.timeOffset=Date.now()+this.delay.remaining-this.file.events[this.currentI].time-e,this.playing=!0,s&&(this.navItems.playPause.paused=!1,this.frameControl.sendReplayMessage({type:"replayPausedChange",paused:!1})),(this.playThreadPromise=this.playThread(0!==e)).then(()=>{this.playThreadPromise=void 0}))}playThread(s=!1){var e=this;return(0,u.Z)(function*(){if(null!=e.file&&null!=e.replayState){console.log("playThread started");let a=s?e.replayState.createSkipState():null;for(let r=e.currentI;r<e.file.events.length;r++){e.currentI=r;let o=e.file.events[r],c=o.time+e.timeOffset-Date.now();if(c>0&&s&&null!=a&&(s=!1,e.skippingDone(e.replayState,a,r-1)),1!=e.speedX&&(e.timeOffset-=c-Math.floor(c/e.speedX),c=Math.floor(c/e.speedX)),s)e.replayState.processEvent(o),e.eventHook(o);else{if(yield e.delay.start(c),e.delay.cancelled)break;e.navItems.skipTo.currentI=r,e.replayState.processEvent(o),"function"==typeof globalThis.replayEventHook&&globalThis.replayEventHook(e,o),e.frameControl.sendReplayMessage({type:"replayEvent",key:o.type,data:o.data})}}let h=!1;s&&null!=a?(s=!1,e.skippingDone(e.replayState,a,e.file.events.length-1),h=!0):e.delay.cancelled||(h=!0),h&&(console.log("File ended"),e.pause()),console.log("playThread stopped")}})()}skippingDone(s,e,a){console.log("Skipping done"),this.navItems.skipTo.currentI=a;let h=s.getSkipStateEvents(e);s.removeSkipState(e),this.frameControl.sendReplayMessage({type:"replayEventPack",events:h})}eventHook(s){"function"==typeof globalThis.replayEventHook&&globalThis.replayEventHook(this,s)}get speedX(){return this.navItems.speedX.value}set speedX(s){this.navItems.speedX.value=s}}return i.\u0275fac=function(s){return new(s||i)(d.Y36(j.Y))},i.\u0275cmp=d.Xpm({type:i,selectors:[["app-index"]],decls:3,vars:5,consts:[[3,"myFrameControl"],["class","message",4,"ngIf"],[1,"message"]],template:function(s,e){1&s&&(d._UZ(0,"app-my-frame",0),d.YNc(1,Y,2,0,"div",1),d.YNc(2,H,2,1,"div",1)),2&s&&(d.Tol(null==e.file?"hidden":""),d.Q6J("myFrameControl",e.frameControl),d.xp6(1),d.Q6J("ngIf",null==e.file&&!e.loading),d.xp6(1),d.Q6J("ngIf",null==e.file&&e.loading))},directives:[V,k.O5],styles:["[_nghost-%COMP%]{flex:1;display:flex}app-my-frame[_ngcontent-%COMP%]{flex:1}app-my-frame.hidden[_ngcontent-%COMP%]{max-width:0}.message[_ngcontent-%COMP%]{flex:1;align-self:center;text-align:center;font-size:3em;line-height:1em}"]}),i})();var B=m(8555);let z=(()=>{class i{}return i.\u0275fac=function(s){return new(s||i)},i.\u0275mod=d.oAB({type:i}),i.\u0275inj=d.cJS({imports:[[k.ez]]}),i})();const Q=[{path:"",component:W}];let q=(()=>{class i{}return i.\u0275fac=function(s){return new(s||i)},i.\u0275mod=d.oAB({type:i}),i.\u0275inj=d.cJS({imports:[[k.ez,B.Bz.forChild(Q),z]]}),i})()}}]);